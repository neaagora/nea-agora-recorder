# Nea Agora Recorder v0.2 – Current Behavior

This documents what v0.2 actually does (not what later versions will do).

## What we capture

From `content.ts`:

- `page_visit` events when a ChatGPT page is loaded.
- `user_prompt` events when the user submits a prompt.

We do **not** yet capture:

- Model responses
- Copy events
- Search / docs navigation
- Tab close, idle, or return behavior

## Where it works

The global listeners are URL-agnostic. They currently work for:

- Plain ChatGPT conversation URLs, for example:
  - `https://chatgpt.com/c/<conversation-id>`
- Project conversations, for example:
  - `https://chatgpt.com/g/<project-id>/c/<conversation-id>`

Other ChatGPT pages (home, project dashboards, etc.) may produce only `page_visit` events with no prompts, which is expected in v0.2.

## Session building

- Events are grouped by `sessionId` derived in `content.ts`.
- For ChatGPT conversations:
  - We use the `/c/<id>` as the stable session id: `chatgpt-c-<conversation-id>`.
- For pages without `/c/<id>`, we generate a tab-scoped fallback id on first use, so all events in that tab share one `sessionId`.

For each session:

- `startedAt` = earliest event timestamp in the group.
- `endedAt` = latest event timestamp in the group.
- `approxDurationMs` = `endedAt - startedAt` (may span hours or days).

## Event kinds

Raw → internal mapping:

- `page_visit` → `InteractionEvent.kind = "session_start"`.
- `user_prompt` → `InteractionEvent.kind = "user_prompt"`.

Counting rules:

- `messageCount` = number of events that are **not** `session_start`.
- `userMessageCount` = number of `"user_prompt"` or `"user_edit"` events.
- `llmMessageCount` = number of `"model_response"` events (currently always 0).

## Human anchors

Each session has a summary with two anchors:

- `outcome: "success" | "abandoned" | "escalated_to_human" | null`
- `neededHumanOverride: boolean | null`

v0.2 rules:

- For unreviewed sessions:
  - `outcome = null`
  - `neededHumanOverride = null`

- If the user ticks "Human override needed" in the popup:
  - `neededHumanOverride = true`
  - `outcome = "escalated_to_human"`

We do **not** automatically label `"success"` or `"abandoned"` in v0.2.

## Popup UI

- Lists sessions, newest first.
- Shows a badge:

  - `Outcome: Unreviewed` when `outcome == null`
  - `Outcome: Escalated to human` when `outcome == "escalated_to_human"`

- A checkbox "Human override needed" per session:

  - When toggled, saves a flag in `chrome.storage.local`
  - Recomputes summaries and re-renders the list
  - Controls the anchors as described above.

## Storage and truncation

- `neaAgoraRecorder` is append-only in v0.2.
- Exports include **all** known sessions.
- There is **no automatic truncation** or cleanup logic yet.

For now, truncation (deleting old sessions) is done manually by the developer when needed. v0.3+ will introduce explicit session-based cleanup.
